<!--suppress BadExpressionStatementJS -->
<html metal:use-macro="load: ../base_layout.pt">
<!DOCTYPE html>
<html lang="${request.locale_name}">
<head>
</head>

<body>
<metal:block fill-slot="content">
    <div class="container">

        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <ol class="breadcrumb">
                    <li><a href="/">Home</a></li>
                    <li>Peptide</li>
                    <li>${peptide}</li>
                </ol>
            </div>
        </div>

        <div class="row">
            <div class="col-md-10 col-md-offset-1 text-center">
                <h1 id="title"></h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <h1>Tissues</h1>
            </div>
            <div class="col-md-10 col-md-offset-1">
                <img id="heart" width="60px" style="opacity: 0.3" src="../static/images/herz.svg">
                <img id="brain" width="60px" style="opacity: 0.3" src="../static/images/hirn.svg">
                <img id="spleen" width="60px" style="opacity: 0.3" src="../static/images/milz.svg">
                <img id="breast" width="60px" style="opacity: 0.3" src="../static/images/brust.svg">
                <img id="uterus" width="60px" style="opacity: 0.3" src="../static/images/uterus.svg">
                <img id="prostate" width="60px" style="opacity: 0.3" src="../static/images/prostata_hoden.svg">
                <img id="lung" width="60px" style="opacity: 0.3" src="../static/images/lungen.svg">
                <img id="kidney" width="60px" style="opacity: 0.3" src="../static/images/niere.svg">
                <img id="bladder" width="60px" style="opacity: 0.3" src="../static/images/blase.svg">
                <img id="liver" width="60px" style="opacity: 0.3" src="../static/images/leber.svg">
                <img id="skin" width="60px" style="opacity: 0.3" src="../static/images/haut.svg">
                <img id="stomach" width="60px" style="opacity: 0.3" src="../static/images/magen.svg">
                <img id="pancreas" width="60px" style="opacity: 0.3" src="../static/images/pankreas.svg">
                <img id="thyroid" width="60px" style="opacity: 0.3" src="../static/images/thyroidea.svg">

            </div>
        </div>
        <br>

        <div class="row">
            <div class="col-md-5 col-md-offset-1">
                <h1>Source Antigen</h1>

                <table class="table table-striped table-bordered" id="proteins">
                    <thead>
                    <tr>
                        <td>Proteins</td>
                        <td>Gene Name</td>
                        <td>Uniprot</td>
                        <td>Position</td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>


                <h1>HLA</h1>

                <h1>Class 1</h1>

                <div class="row no-gutters">
                    <div class="col-md-4">
                        <table class="table table-striped table-bordered" id="hla_class1_A">
                            <thead>
                            <tr>
                                <td>HLA-A</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-4">
                        <table class="table table-striped table-bordered" id="hla_class1_B">
                            <thead>
                            <tr>
                                <td>HLA-B</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-4">
                        <table class="table table-striped table-bordered" id="hla_class1_C">
                            <thead>
                            <tr>
                                <td>HLA-C</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
            </div>

                <h1>Class 2</h1>

                <div class="row no-gutters">
                    <div class="col-md-3">
                        <table class="table table-striped table-bordered" id="hla_class2_DP">
                            <thead>
                            <tr>
                                <td>HLA-DP</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-striped table-bordered" id="hla_class2_DQ">
                            <thead>
                            <tr>
                                <td>HLA-DQ</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="col-md-3">
                        <table class="table table-striped table-bordered" id="hla_class2_DRB">
                            <thead>
                            <tr>
                                <td>HLA-DRB</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
            </div>

        </div>

            <div class="col-md-5">
                <h1>Experimental Evidence</h1>
                The peptide was found in ${ms_run_count} MS runs with <a href="/peptide_spectra/${peptide}" >${psms} PSMs</a>.

                <br>

                <h1>Related Information</h1>
                SYFPEITHI
                <a href="http://www.syfpeithi.de/"><span class="glyphicon glyphicon-globe"
                                                         aria-hidden="true"></span></a>
                <br>
                IEDB <a href="http://www.iedb.org/epitope/58560"><span class="glyphicon glyphicon-globe"
                                                                       aria-hidden="true"></span></a>
                <br>
                PubMed
                <a href="http://www.ncbi.nlm.nih.gov/pubmed/?term="><span class="glyphicon glyphicon-globe"
                                                                          aria-hidden="true"></span></a>
        </div>
    </div>
</div>

<script>
    // TODO: allow subtissues
    var organs = ["heart", "brain", "spleen", "breast", "uterus", "prostate", "lung", "kidney", "bladder", "liver", "skin", "stomach", "pancreas", "thyroid"];

    // Set Opacity of the found tissues
    // TODO: allow subtissues
    $(document).ready(function(){
        var found_organs = ${organs};
        console.log(found_organs);
        for(var i=0; i < organs.length; i++){
            for(var j=0; j < found_organs.length; j++){
                if(organs[i].charAt(0).toUpperCase() + organs[i].slice(1)== found_organs[j]){
                    console.log(organs[i]);
                    $('#'+organs[i]).css('opacity', '1');
                    console.log($('#'+organs[i]));
                }
            }

        }

    });



    $(document).ready(function () {
        // Setting the title
        document.getElementById("title").innerHTML = "${peptide}";
    });
    $(document).ready(function () {
// create dataTable
        //"pageLength": 50
        var class1_length = Math.max(${hla_class1_A}.length, ${hla_class1_B}.length,${hla_class1_C}.length);

        //console.log(class1_length);
        var tab = $('#hla_class1_A').DataTable({
            "paging": false,
            "ordering": false,
            "info": false,
            "defaultContent": 'No entries to show',
            "searching": false,
            data: ${hla_class1_A},
            columns: [
                {"render": function (data, type, row) {
                    return "<a class='nostylelink'  href= '/hla/" + data + "'>" + data + "</a>";
                }}
            ]
        });
        for (var i = 1; i <= class1_length -${hla_class1_A}.length;i++)
        {
            tab.row.add(["-"]).draw();
        }

        var tab = $('#hla_class1_B').DataTable({
            "paging": false,
            "ordering": false,
            "info": false,
            searching: false,
            data: ${hla_class1_B},
            columns: [
                {"render": function (data, type, row) {
                    return "<a class='nostylelink'  href= '/hla/" + data + "'>" + data + "</a>";
                }}
            ]
        });

        for (var i = 1; i <= class1_length -${hla_class1_B}.length;i++)
        {
            tab.row.add(["-"]).draw();
        }

        var tab = $('#hla_class1_C').DataTable({
            "paging": false,
            "ordering": false,
            "info": false,
            searching: false,
            data: ${hla_class1_C},
            columns: [
                {"render": function (data, type, row) {
                    return "<a class='nostylelink'  href= '/hla/" + data + "'>" + data + "</a>";
                }}
            ]
        });

        for (var i = 1; i <= class1_length -${hla_class1_C}.length;i++)
        {
            tab.row.add(["-"]).draw();
        }


        var class2_length = Math.max(${hla_class2_DP}.length, ${hla_class2_DQ}.length,${hla_class2_DRB}.length)
        var tab = $('#hla_class2_DP').DataTable({
            "paging": false,
            "ordering": false,
            "info": false,
            searching: false,
            data: ${hla_class2_DP},
            columns: [
                {"render": function (data, type, row) {
                    return "<a class='nostylelink'  href= '/hla/" + data + "'>" + data + "</a>";
                }}
            ]
        });
        for (var i = 1; i <= class2_length -${hla_class2_DP}.length;i++)
        {
            tab.row.add(["-"]).draw();
        }

        var tab = $('#hla_class2_DQ').DataTable({
            "paging": false,
            "ordering": false,
            "info": false,
            searching: false,
            data: ${hla_class2_DQ},
            columns: [
                {"render": function (data, type, row) {
                    return "<a class='nostylelink'  href= '/hla/" + data + "'>" + data + "</a>";
                }}
            ]
        });
        for (var i = 1; i <= class2_length -${hla_class2_DQ}.length;i++)
        {
            tab.row.add(["-"]).draw();
        }


        var tab = $('#hla_class2_DRB').DataTable({
            "paging": false,
            "ordering": false,
            "info": false,
            searching: false,
            data: ${hla_class2_DRB},
            columns: [
                {"render": function (data, type, row) {
                    return "<a class='nostylelink'  href= '/hla/" + data + "'>" + data + "</a>";
                }}
            ]
        });
        for (var i = 1; i <= class2_length -${hla_class2_DRB}.length;i++)
        {
            tab.row.add(["-"]).draw();
        }





        $('#proteins').dataTable({
            "paging": false,
            "ordering": false,
            "info": false,
            searching: false,
            data: ${proteins},
            columns: [
                {data: "protein",
                    "render": function (data, type, row) {
                        return "<a class='nostylelink'  href= '/protein/" + data +"$uniprot" +  "'>" + data + "</a>";
                    }},
                {data: "gene_name"},
                {data: "protein",
                    "render": function (data, type, row) {
                        return "<a class='nostylelink'  href= 'http://www.uniprot.org/uniprot/" + data + "'>" + "Link" + "</a>";
                    }},
                {data: "sequence",
                    "render": function (data, type, row) {
                        var n = data.indexOf("${peptide}");
                        // TODO: does not work if the peptide is twice in the same protein
                        return (n + 1) + " - " + (n + "${peptide}".length);
                    }
                }

            ]
        });
    });

</script>

</metal:block>

</body>

</html>
</html>